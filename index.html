<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gifts Forge</title>
<style>
:root {
  --bg: #0d0d0d;
  --accent: #ff7b00;
  --text: #fff;
  --card-bg: #1a1a1a;
  --card-border: #ff7b00aa;
}
*{box-sizing:border-box;font-family:'Segoe UI',Tahoma,sans-serif;}
body{margin:0;background-color:var(--bg);color:var(--text);display:flex;flex-direction:column;height:100vh;overflow:hidden;}
header{text-align:center;padding:12px 0;background:#111;border-bottom:2px solid var(--accent);font-size:1.4rem;letter-spacing:1px;position:relative;z-index:2;}
#starBalance{position:absolute;right:20px;top:12px;font-size:1rem;color:var(--accent);}
main{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:flex-start;padding:20px;overflow-y:auto;}
.hidden{display:none;}
.forge-area,.inventory{text-align:center;max-width:700px;width:100%;border:2px solid var(--card-border);background:var(--card-bg);border-radius:16px;padding:20px;margin-bottom:20px;box-shadow:0 0 10px #ff7b0033;position:relative;z-index:1;}
.forge-cards{display:grid;grid-template-columns:repeat(3,1fr);gap:15px;margin-top:20px;position:relative;}
#lineCanvas{position:absolute;top:0;left:0;width:100%;height:100%;z-index:0;pointer-events:none;}
.forge-card{height:100px;border:2px dashed var(--accent);border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:1.2rem;cursor:pointer;transition:0.3s;background:#222;position:relative;z-index:2;}
#forgeButton{margin-top:20px;background:var(--accent);color:#000;border:none;border-radius:12px;padding:12px 25px;font-size:1.1rem;cursor:pointer;transition:0.2s;}
#forgeButton:hover{transform:scale(1.05);box-shadow:0 0 15px var(--accent);}
.result{margin-top:15px;font-size:1.1rem;color:var(--accent);}
footer{display:flex;justify-content:space-around;border-top:2px solid var(--accent);background:#111;padding:12px 0;position:fixed;bottom:0;width:100%;z-index:3;}
footer button{background:none;border:none;color:var(--text);font-size:1.1rem;cursor:pointer;}
footer button.active{color:var(--accent);font-weight:bold;}
.inventory-items{display:flex;flex-wrap:wrap;justify-content:center;gap:10px;}
.inv-item{width:90px;height:90px;border:2px solid var(--accent);border-radius:12px;display:flex;flex-direction:column;align-items:center;justify-content:center;background:#222;text-align:center;padding:5px;font-size:0.8rem;cursor:pointer;transition:.3s;}
.inv-item:hover{background:var(--accent);color:#000;}
.inv-item.rare1{border-color:#00eaff;box-shadow:0 0 10px #00eaff;}
.inv-item.rare2{border-color:#0066ff;box-shadow:0 0 10px #0066ff;}
.inv-item.rare3{border-color:#b600ff;box-shadow:0 0 10px #b600ff;}
.inv-item.rare4{border-color:#ff00aa;box-shadow:0 0 10px #ff00aa;}
.inv-item.rare5{border-color:#ff0000;box-shadow:0 0 10px #ff0000;}

/* –†—É–ª–µ—Ç–∫–∞ */
#rouletteOverlay{
  position:fixed;top:0;left:0;width:100%;height:100%;
  background:rgba(0,0,0,0.9);display:flex;align-items:center;justify-content:center;
  z-index:1500;flex-direction:column;
  opacity:0;pointer-events:none;transition:opacity 0.5s ease;
}
#rouletteOverlay.active{opacity:1;pointer-events:auto;}
#rouletteContainer{
  width:100vw;height:180px;overflow:hidden;position:relative;background:transparent;
}
#rouletteLine{
  display:flex;gap:15px;position:absolute;left:0;top:30px;height:120px;align-items:center;will-change:transform;
}
.roulette-item{
  width:140px;height:140px;background:#222;border-radius:12px;border:2px solid var(--accent);
  display:flex;align-items:center;justify-content:center;flex-direction:column;font-size:0.9rem;flex-shrink:0;
}
.roulette-underline{height:5px;width:60%;margin-top:5px;border-radius:4px;}
#rouletteMarker{
  position:absolute;top:0;left:50%;transform:translateX(-50%);
  width:4px;height:100%;background:var(--accent);z-index:10;
}
#rouletteResult{margin-top:25px;font-size:1.3rem;color:var(--accent);opacity:0;transition:opacity .3s;}
</style>
</head>
<body>
<header>üî• Gifts Forge üî• <span id="starBalance">‚≠ê 10 000</span></header>

<main>
  <div id="forgeTab" class="forge-area">
    <h2>–ö—É–∑–Ω–∏—Ü–∞</h2>
    <div class="forge-cards" id="forgeCards">
      <canvas id="lineCanvas"></canvas>
      <div class="forge-card">+</div><div class="forge-card">+</div><div class="forge-card">‚≠ê</div>
      <div class="forge-card">+</div><div class="forge-card">+</div><div class="forge-card">üß©</div>
    </div>
    <button id="forgeButton">–ö–æ–≤–∞—Ç—å!</button>
    <div class="result" id="forgeResult"></div>
  </div>
  <div id="inventoryTab" class="inventory hidden">
    <h2>–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</h2>
    <div class="inventory-items" id="inventoryItems"></div>
  </div>
</main>

<footer>
  <button id="navForge" class="active">üî® Forge</button>
  <button id="navInventory">üéÅ Inventory</button>
</footer>

<!-- –†—É–ª–µ—Ç–∫–∞ -->
<div id="rouletteOverlay">
  <div id="rouletteContainer">
    <div id="rouletteLine"></div>
    <div id="rouletteMarker"></div>
  </div>
  <div id="rouletteResult"></div>
</div>

<script>
const TON_TO_STARS=142;
const gifts = [
  {name:"Plush Pepe", ton:4930},
  {name:"Heart Locket", ton:1210},
  {name:"Durov's Cap", ton:870},
  {name:"Precious Peach", ton:389.5},
  {name:"Heroic Helmet", ton:255},
  {name:"Mighty Arm", ton:199.99},
  {name:"Nail Bracelet", ton:124.8},
  {name:"Astral Shard", ton:119.13},
  {name:"Artisan Brick", ton:110.24},
  {name:"Mini Oscar", ton:93.19},
  {name:"Loot Bag", ton:93},
  {name:"Ion Gem", ton:82.38},
  {name:"Perfume Bottle", ton:80.62},
  {name:"Magic Potion", ton:73.9},
  {name:"Gem Signet", ton:66.89},
  {name:"Scared Cat", ton:57.69},
  {name:"Bonded Ring", ton:53.97},
  {name:"Westside Sign", ton:53.6},
  {name:"Genie Lamp", ton:47},
  {name:"Swiss Watch", ton:40},
  {name:"Sharp Tongue", ton:39.76},
  {name:"Kissed Frog", ton:31.25},
  {name:"Electric Skull", ton:30.4},
  {name:"Signet Ring", ton:27.78},
  {name:"Neko Helmet", ton:27},
  {name:"Low Rider", ton:26.11},
  {name:"Vintage Cigar", ton:25},
  {name:"Toy Bear", ton:24.11},
  {name:"Voodoo Doll", ton:18.88},
  {name:"Mad Pumpkin", ton:18.27},
  {name:"Diamond Ring", ton:18},
  {name:"Eternal Rose", ton:15.17},
  {name:"Ionic Dryer", ton:11.4},
  {name:"Cupid Charm", ton:11.01},
  {name:"Love Potion", ton:10.38},
  {name:"Flying Broom", ton:9.77},
  {name:"Trapped Heart", ton:8.67},
  {name:"Top Hat", ton:8.57},
  {name:"Skull Flower", ton:8.48},
  {name:"Crystal Ball", ton:8.24},
  {name:"Record Player", ton:8},
  {name:"Sky Stilettos", ton:7.32},
  {name:"Love Candle", ton:7.15},
  {name:"Sleigh Bell", ton:6.6},
  {name:"Snoop Cigar", ton:5.89},
  {name:"Hanging Star", ton:5.3},
  {name:"Sakura Flower", ton:5.21},
  {name:"Valentine Box", ton:4.61},
  {name:"Jolly Chimp", ton:4.51},
  {name:"Evil Eye", ton:4.4},
  {name:"Berry Box", ton:3.98},
  {name:"Eternal Candle", ton:3.92},
  {name:"Snow Mittens", ton:3.9},
  {name:"Spy Agaric", ton:3.88},
  {name:"Input Key", ton:3.76},
  {name:"Jelly Bunny", ton:3.75},
  {name:"Bow Tie", ton:3.6},
  {name:"Bunny Muffin", ton:3.46},
  {name:"Light Sword", ton:3.3},
  {name:"Witch Hat", ton:3.14},
  {name:"Hex Pot", ton:3.07},
  {name:"Lush Bouquet", ton:3.07},
  {name:"Joyful Bundle", ton:3.07},
  {name:"Snow Globe", ton:2.89},
  {name:"Restless Jar", ton:2.72},
  {name:"Santa Hat", ton:2.68},
  {name:"Easter Egg", ton:2.61},
  {name:"Star Notepad", ton:2.5},
  {name:"Moon Pendant", ton:2.5},
  {name:"Jack-in-the-Box", ton:2.4},
  {name:"Swag Bag", ton:2.4},
  {name:"Fresh Socks", ton:2.2},
  {name:"Spiced Wine", ton:2.19},
  {name:"Stellar Rocket", ton:2.18},
  {name:"Snoop Dogg", ton:2.15},
  {name:"Cookie Heart", ton:2.12},
  {name:"Jingle Bells", ton:2.12},
  {name:"Tama Gadget", ton:2.11},
  {name:"Hypno Lollipop", ton:2.09},
  {name:"Winter Wreath", ton:2.06},
  {name:"Party Sparkler", ton:2.06},
  {name:"Ginger Cookie", ton:2.05},
  {name:"Big Year", ton:2.02},
  {name:"Jester Hat", ton:2},
  {name:"Holiday Drink", ton:1.93},
  {name:"Pet Snake", ton:1.93},
  {name:"Homemade Cake", ton:1.91},
  {name:"Candy Cane", ton:1.89},
  {name:"Clover Pin", ton:1.88},
  {name:"Whip Cupcake", ton:1.8},
  {name:"Xmas Stocking", ton:1.77},
  {name:"Snake Box", ton:1.72},
  {name:"Lunar Snake", ton:1.7},
  {name:"Lol Pop", ton:1.67},
  {name:"B-Day Candle", ton:1.61},
  {name:"Desk Calendar", ton:1.5}
];

let stars=10000;
let inventory=gifts.slice();
let selectedComponents=Array(6).fill(null);
let activeCardIndex=null;
const forgeCards=document.querySelectorAll(".forge-card");
const lineCanvas=document.getElementById("lineCanvas");
const ctx=lineCanvas.getContext("2d");
const forgeButton=document.getElementById("forgeButton");
const forgeResult=document.getElementById("forgeResult");
const rouletteOverlay=document.getElementById("rouletteOverlay");
const rouletteLine=document.getElementById("rouletteLine");
const rouletteResultText=document.getElementById("rouletteResult");

function rarityColor(v){if(v<500)return"#00eaff";if(v<1000)return"#0066ff";if(v<4000)return"#b600ff";if(v<8000)return"#ff00aa";return"#ff0000";}
function rarityClass(v){if(v<500)return"rare1";if(v<1000)return"rare2";if(v<4000)return"rare3";if(v<8000)return"rare4";return"rare5";}

function renderStars(){document.getElementById("starBalance").textContent=`‚≠ê ${Math.floor(stars).toLocaleString()}`;}
function renderInventory(){
  const c=document.getElementById("inventoryItems");
  c.innerHTML="";
  inventory.forEach(it=>{
    const val=Math.round(it.ton*TON_TO_STARS);
    const d=document.createElement("div");
    d.className=`inv-item ${rarityClass(val)}`;
    d.innerHTML=`${it.name}<br>${val}‚≠ê`;
    c.appendChild(d);
  });
}
function renderForgeCards(){
  forgeCards.forEach((c,i)=>{
    c.textContent=selectedComponents[i]?selectedComponents[i].name:(i==2?"‚≠ê":i==5?"üß©":"+");
  });
}
forgeCards.forEach((card,i)=>{
  card.onclick=()=>{
    activeCardIndex=i;
    if(i===2){
      const amt=parseInt(prompt("–í–≤–µ–¥–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–≤—ë–∑–¥ (1‚Äì1000):","100"));
      if(!isNaN(amt)&&amt>0)selectedComponents[i]={name:`‚≠ê ${amt}`,ton:amt/TON_TO_STARS};
      renderForgeCards();
    }else{
      const g=gifts[Math.floor(Math.random()*gifts.length)];
      selectedComponents[i]=g;
      renderForgeCards();
    }
  };
});

let tick=0;
function drawLines(){
  ctx.clearRect(0,0,lineCanvas.width,lineCanvas.height);
  const rect=lineCanvas.getBoundingClientRect();
  const pos=[];
  forgeCards.forEach(card=>{
    const r=card.getBoundingClientRect();
    if(card.textContent!=="+"&&card.textContent!=="‚≠ê"&&card.textContent!=="üß©"){
      pos.push({x:r.left-rect.left+r.width/2,y:r.top-rect.top+r.height/2});
    }
  });
  const n=pos.length;if(n<2)return;
  const period=n===2?1000:n===3?750:n===4?600:n===5?500:333;
  tick=(tick+1)%period;
  const alpha=0.5+0.5*Math.sin(tick/period*2*Math.PI);
  ctx.lineWidth=2+n/2;ctx.strokeStyle=`rgba(255,123,0,${0.4+alpha*0.6})`;
  ctx.shadowColor="orange";ctx.shadowBlur=8;
  ctx.beginPath();
  for(let i=0;i<n;i++)for(let j=i+1;j<n;j++){ctx.moveTo(pos[i].x,pos[i].y);ctx.lineTo(pos[j].x,pos[j].y);}
  ctx.stroke();
}
setInterval(drawLines,60);
window.onresize=drawLines;

// --- —Ä—É–ª–µ—Ç–∫–∞ ---
function startRoulette(finalGift){
  rouletteOverlay.classList.add("active");
  rouletteLine.innerHTML="";rouletteResultText.style.opacity=0;
  const seq=[];
  for(let i=0;i<40;i++)seq.push(gifts[Math.floor(Math.random()*gifts.length)]);
  seq[seq.length-7]=finalGift;

  seq.forEach(g=>{
    const d=document.createElement("div");d.className="roulette-item";
    const val=Math.round(g.ton*TON_TO_STARS);
    d.innerHTML=g.name;
    const u=document.createElement("div");
    u.className="roulette-underline";u.style.background=rarityColor(val);
    d.appendChild(u);rouletteLine.appendChild(d);
  });

  const itemWidth=155;
  const stopIndex=seq.length-7;
  const totalShift=stopIndex*itemWidth - window.innerWidth/2 + itemWidth/2; // —Ü–µ–Ω—Ç—Ä —Ç–æ—á–Ω–æ –Ω–∞ –ø—Ä–∏–∑–µ

  let t=0;let duration=4000;let start=null;
  function animateRoulette(ts){
    if(!start)start=ts;
    t=ts-start;
    const progress=Math.min(t/duration,1);
    const ease=1-Math.pow(1-progress,3);
    rouletteLine.style.transform=`translateX(-${ease*totalShift}px)`;
    if(progress<1)requestAnimationFrame(animateRoulette);
    else{
      rouletteResultText.textContent=`üéÅ ${finalGift.name} –ø–æ–ª—É—á–µ–Ω!`;
      rouletteResultText.style.opacity=1;
      inventory.push(finalGift);renderInventory();renderStars();
      setTimeout(()=>{rouletteOverlay.classList.remove("active");},2500);
    }
  }
  requestAnimationFrame(animateRoulette);
}

// --- –∫–æ–≤–∫–∞ ---
forgeButton.onclick=()=>{
  const comps=selectedComponents.filter(Boolean);
  if(comps.length<2)return forgeResult.textContent="‚ö†Ô∏è –ù—É–∂–Ω–æ –º–∏–Ω–∏–º—É–º 2 –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞!";
  forgeButton.disabled=true;forgeButton.textContent="‚õè –ö–æ–≤–∫–∞...";
  const goodChance=0.7;
  const success=Math.random()<goodChance;
  let gift;
  if(success){
    const vals=comps.filter(c=>c.ton).map(c=>c.ton*TON_TO_STARS);
    const avg=vals.reduce((a,b)=>a+b,0)/vals.length;
    const candidates=gifts.filter(g=>g.ton*TON_TO_STARS>=avg*0.8&&g.ton*TON_TO_STARS<=avg*1.2);
    gift=candidates.length?candidates[Math.floor(Math.random()*candidates.length)]:gifts[Math.floor(Math.random()*gifts.length)];
  }else gift=gifts[Math.floor(Math.random()*gifts.length)];
  startRoulette(gift);
  selectedComponents=Array(6).fill(null);
  renderForgeCards();
  setTimeout(()=>{forgeButton.disabled=false;forgeButton.textContent="–ö–æ–≤–∞—Ç—å!";},4500);
};

// –Ω–∞–≤–∏–≥–∞—Ü–∏—è
document.getElementById("navForge").onclick=()=>{document.getElementById("forgeTab").classList.remove("hidden");document.getElementById("inventoryTab").classList.add("hidden");};
document.getElementById("navInventory").onclick=()=>{document.getElementById("forgeTab").classList.add("hidden");document.getElementById("inventoryTab").classList.remove("hidden");};

// init
renderStars();renderInventory();renderForgeCards();drawLines();
</script>
</body>
</html>
